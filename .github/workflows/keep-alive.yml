name: Keep Backend Alive

on:
  schedule:
    # Run every 10 minutes
    - cron: "*/10 * * * *"
  workflow_dispatch: # Allow manual triggering

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Backend Health Endpoint
        run: |
          # Replace with your actual backend URL or use a secret/env
          # For example: curl -f https://your-backend-url.onrender.com/health
          # We can use a GitHub Secret called BACKEND_URL
          if [ -n "${{ secrets.BACKEND_URL }}" ]; then
            # Retry up to 5 times, wait 10 seconds between retries, max time 180s to allow for cold starts
            curl -f --retry 5 --retry-delay 10 --retry-connrefused --max-time 180 "${{ secrets.BACKEND_URL }}/health"
          else
            echo "BACKEND_URL secret is not set. Please add it to your repo secrets."
            exit 1
          fi
